<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Alchemist's Apprentice - Tower of Elements</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:wght@400;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Crimson Text', serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
            color: #f0f0f0;
            overflow-x: hidden;
            overflow-y: auto;
            user-select: none;
            min-height: 100vh;
        }
        
        .game-container {
            width: 100vw;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        /* Animated Background */
        .bg-particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: #ffd700;
            border-radius: 50%;
            animation: float 6s infinite ease-in-out;
            opacity: 0.7;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.7; }
            50% { transform: translateY(-20px) rotate(180deg); opacity: 1; }
        }
        
        /* Main Game UI */
        .game-ui {
            position: relative;
            z-index: 10;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Top HUD */
        .hud {
            background: linear-gradient(90deg, rgba(26, 26, 46, 0.9) 0%, rgba(22, 33, 62, 0.9) 100%);
            padding: 15px 30px;
            border-bottom: 2px solid #ffd700;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
        }
        
        .player-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .player-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            border: 3px solid #ffd700;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); }
        }
        
        .player-stats {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .player-name {
            font-family: 'Cinzel', serif;
            font-size: 18px;
            font-weight: 600;
            color: #ffd700;
        }
        
        .level-info {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .resources {
            display: flex;
            gap: 30px;
        }
        
        .resource {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 215, 0, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .resource-icon {
            font-size: 18px;
        }
        
        .resource-amount {
            font-weight: 600;
            color: #ffd700;
        }
        
        /* Main Game Area */
        .game-main {
            flex: 1;
            display: flex;
            position: relative;
        }
        
        /* Tower Navigation */
        .tower-nav {
            width: 300px;
            background: linear-gradient(180deg, rgba(26, 26, 46, 0.95) 0%, rgba(22, 33, 62, 0.95) 100%);
            border-right: 2px solid #ffd700;
            backdrop-filter: blur(15px);
            display: flex;
            flex-direction: column;
            padding: 20px;
        }
        
        .tower-title {
            font-family: 'Cinzel', serif;
            font-size: 24px;
            font-weight: 700;
            text-align: center;
            color: #ffd700;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .floors-container {
            flex: 1;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #ffd700 transparent;
        }
        
        .floor {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1) 0%, rgba(255, 165, 0, 0.1) 100%);
            border-radius: 15px;
            margin-bottom: 15px;
            padding: 20px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .floor::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.1), transparent);
            transition: left 0.5s ease;
        }
        
        .floor:hover::before {
            left: 100%;
        }
        
        .floor:hover {
            border-color: #ffd700;
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.2);
        }
        
        .floor.active {
            border-color: #ffd700;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 165, 0, 0.15) 100%);
        }
        
        .floor.completed {
            border-color: #4ade80;
            background: linear-gradient(135deg, rgba(74, 222, 128, 0.1) 0%, rgba(34, 197, 94, 0.1) 100%);
        }
        
        .floor.locked {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(50%);
        }
        
        .floor-number {
            font-family: 'Cinzel', serif;
            font-size: 18px;
            font-weight: 600;
            color: #ffd700;
            margin-bottom: 8px;
        }
        
        .floor-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .floor-description {
            font-size: 14px;
            opacity: 0.8;
            line-height: 1.4;
        }
        
        .floor-progress {
            margin-top: 10px;
            background: rgba(0, 0, 0, 0.3);
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
        }
        
        .floor-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #ffd700, #ffa500);
            transition: width 0.5s ease;
            border-radius: 3px;
        }
        
        /* Game Area */
        .game-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        /* Lab Environment */
        .lab-environment {
            flex: 1;
            background: linear-gradient(135deg, rgba(34, 40, 49, 0.9) 0%, rgba(57, 62, 70, 0.9) 100%);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        
        .lab-content {
            width: 90%;
            height: 90%;
            background: linear-gradient(135deg, rgba(26, 32, 44, 0.95) 0%, rgba(45, 55, 72, 0.95) 100%);
            border-radius: 20px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            padding: 30px;
            display: flex;
            gap: 30px;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        /* Workbench Area */
        .workbench {
            flex: 2;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .challenge-panel {
            background: linear-gradient(135deg, rgba(75, 85, 99, 0.6) 0%, rgba(55, 65, 81, 0.6) 100%);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(255, 215, 0, 0.2);
        }
        
        .challenge-title {
            font-family: 'Cinzel', serif;
            font-size: 20px;
            font-weight: 600;
            color: #ffd700;
            margin-bottom: 10px;
        }
        
        .challenge-description {
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .challenge-equation {
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            text-align: center;
            border: 1px solid rgba(255, 215, 0, 0.3);
            color: #64ffda;
        }
        
        /* Cauldron Area */
        .cauldron-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .cauldron {
            width: 200px;
            height: 200px;
            background: radial-gradient(circle at center, #2d3748 0%, #1a202c 100%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            border: 4px solid #ffd700;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .cauldron:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(255, 215, 0, 0.3);
        }
        
        .cauldron-liquid {
            width: 80%;
            height: 60%;
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            opacity: 0.8;
            animation: bubble 2s infinite ease-in-out;
        }
        
        @keyframes bubble {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .brew-button {
            background: linear-gradient(135deg, #ffd700 0%, #ffa500 100%);
            color: #1a202c;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-family: 'Cinzel', serif;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }
        
        .brew-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.5);
        }
        
        .brew-button:active {
            transform: translateY(0);
        }
        
        /* Ingredients Panel */
        .ingredients-panel {
            flex: 1;
            background: linear-gradient(135deg, rgba(75, 85, 99, 0.6) 0%, rgba(55, 65, 81, 0.6) 100%);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(255, 215, 0, 0.2);
        }
        
        .ingredients-title {
            font-family: 'Cinzel', serif;
            font-size: 18px;
            font-weight: 600;
            color: #ffd700;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .ingredients-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
            height: 400px;
            overflow-y: auto;
            padding-right: 8px;
            scrollbar-width: thin;
            scrollbar-color: #ffd700 rgba(255, 215, 0, 0.1);
        }
        
        .ingredients-grid::-webkit-scrollbar {
            width: 6px;
        }
        
        .ingredients-grid::-webkit-scrollbar-track {
            background: rgba(255, 215, 0, 0.1);
            border-radius: 3px;
        }
        
        .ingredients-grid::-webkit-scrollbar-thumb {
            background: #ffd700;
            border-radius: 3px;
        }
        
        .ingredient {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.3) 0%, rgba(139, 92, 246, 0.3) 100%);
            border-radius: 12px;
            padding: 16px 20px;
            cursor: grab;
            transition: all 0.3s ease;
            border: 3px solid rgba(255, 215, 0, 0.4);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 15px;
            min-height: 60px;
        }
        
        .ingredient:hover {
            border-color: #ffd700;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.4) 0%, rgba(139, 92, 246, 0.4) 100%);
        }
        
        .ingredient:active {
            cursor: grabbing;
            transform: translateY(0);
        }
        
        .ingredient-icon {
            font-size: 28px;
            flex-shrink: 0;
            width: 40px;
            text-align: center;
        }
        
        .ingredient-name {
            font-size: 16px;
            font-weight: 600;
            line-height: 1.3;
            flex: 1;
            text-align: left;
        }
        
        /* AI Guide */
        .ai-guide {
            position: absolute;
            bottom: 30px;
            right: 30px;
            width: 300px;
            background: linear-gradient(135deg, rgba(26, 32, 44, 0.95) 0%, rgba(45, 55, 72, 0.95) 100%);
            border-radius: 20px;
            padding: 20px;
            border: 2px solid #ffd700;
            backdrop-filter: blur(20px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            animation: slideInRight 0.5s ease;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .guide-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .guide-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            animation: float 3s infinite ease-in-out;
        }
        
        .guide-name {
            font-family: 'Cinzel', serif;
            font-size: 16px;
            font-weight: 600;
            color: #ffd700;
        }
        
        .guide-message {
            font-size: 14px;
            line-height: 1.5;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #ffd700;
        }
        
        /* Success/Failure Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        .modal-content {
            background: linear-gradient(135deg, rgba(26, 32, 44, 0.95) 0%, rgba(45, 55, 72, 0.95) 100%);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            border: 2px solid #ffd700;
            max-width: 500px;
            animation: modalPop 0.5s ease;
        }
        
        @keyframes modalPop {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .modal-icon {
            font-size: 60px;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-family: 'Cinzel', serif;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 15px;
        }
        
        .modal-message {
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 30px;
        }
        
        .modal-button {
            background: linear-gradient(135deg, #ffd700 0%, #ffa500 100%);
            color: #1a202c;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-family: 'Cinzel', serif;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .modal-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.5);
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .tower-nav {
                width: 250px;
            }
            
            .lab-content {
                flex-direction: column;
                gap: 20px;
            }
            
            .workbench {
                flex-direction: row;
            }
            
            .ai-guide {
                position: relative;
                bottom: auto;
                right: auto;
                width: 100%;
                margin-top: 20px;
            }
        }
        
        @media (max-width: 768px) {
            .hud {
                padding: 10px 15px;
                flex-direction: column;
                gap: 15px;
            }
            
            .resources {
                gap: 15px;
            }
            
            .game-main {
                flex-direction: column;
            }
            
            .tower-nav {
                width: 100%;
                max-height: 200px;
                flex-direction: row;
                overflow-x: auto;
                padding: 15px;
            }
            
            .floors-container {
                display: flex;
                gap: 15px;
                min-width: max-content;
            }
            
            .floor {
                min-width: 200px;
                margin-bottom: 0;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Animated Background -->
        <div class="bg-particles" id="particles"></div>
        
        <!-- Main Game UI -->
        <div class="game-ui">
            <!-- Top HUD -->
            <div class="hud">
                <div class="player-info">
                    <div class="player-avatar">üßô</div>
                    <div class="player-stats">
                        <div class="player-name">Apprentice Alchemist</div>
                        <div class="level-info">Level <span id="player-level">1</span> ‚Ä¢ Floor <span id="current-floor">1</span></div>
                    </div>
                </div>
                <div class="resources">
                    <div class="resource">
                        <span class="resource-icon">‚≠ê</span>
                        <span class="resource-amount" id="essence-count">25</span>
                    </div>
                    <div class="resource">
                        <span class="resource-icon">üíé</span>
                        <span class="resource-amount" id="crystal-count">8</span>
                    </div>
                    <div class="resource">
                        <span class="resource-icon">üèÜ</span>
                        <span class="resource-amount" id="achievements-count">0</span>
                    </div>
                </div>
            </div>
            
            <!-- Main Game Area -->
            <div class="game-main">
                <!-- Tower Navigation -->
                <div class="tower-nav">
                    <div class="tower-title">Tower of Elements</div>
                    <div class="floors-container" id="floors-container">
                        <!-- Floors will be generated dynamically -->
                    </div>
                </div>
                
                <!-- Game Area -->
                <div class="game-area">
                    <div class="lab-environment">
                        <div class="lab-content">
                            <!-- Workbench -->
                            <div class="workbench">
                                <div class="challenge-panel">
                                    <div class="challenge-title" id="challenge-title">The Rusty Knight</div>
                                    <div class="challenge-description" id="challenge-description">
                                        A brave knight's armor has become rusty after many battles. Create an acid solution to remove the rust (Fe‚ÇÇO‚ÇÉ) and restore the armor's shine!
                                    </div>
                                    <div class="challenge-equation" id="challenge-equation">
                                        Fe‚ÇÇO‚ÇÉ + 6HCl ‚Üí 2FeCl‚ÇÉ + 3H‚ÇÇO
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Cauldron Area -->
                            <div class="cauldron-area">
                                <div class="cauldron" id="cauldron">
                                    <div class="cauldron-liquid" id="cauldron-liquid"></div>
                                </div>
                                <button class="brew-button" id="brew-button">üî• Brew Potion</button>
                                <div id="current-formula" style="font-size: 14px; opacity: 0.8; text-align: center;"></div>
                            </div>
                            
                            <!-- Ingredients Panel -->
                            <div class="ingredients-panel">
                                <div class="ingredients-title">Alchemical Ingredients</div>
                                <div class="ingredients-grid" id="ingredients-grid">
                                    <!-- Ingredients will be generated dynamically -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- AI Guide -->
        <div class="ai-guide" id="ai-guide">
            <div class="guide-header">
                <div class="guide-avatar">ü¶â</div>
                <div class="guide-name">Athena, Your Guide</div>
            </div>
            <div class="guide-message" id="guide-message">
                Welcome, young alchemist! I'll help guide you through the mysteries of chemistry. Start by dragging ingredients into your cauldron to create the perfect solution!
            </div>
        </div>
        
        <!-- Success Modal -->
        <div class="modal" id="success-modal">
            <div class="modal-content">
                <div class="modal-icon" style="color: #4ade80;">‚ú®</div>
                <div class="modal-title" style="color: #4ade80;">Excellent Work!</div>
                <div class="modal-message" id="success-message">
                    You've successfully created the perfect potion! The knight's armor gleams like new.
                </div>
                <button class="modal-button" onclick="closeModal('success-modal')">Continue Adventure</button>
            </div>
        </div>
        
        <!-- Failure Modal -->
        <div class="modal" id="failure-modal">
            <div class="modal-content">
                <div class="modal-icon" style="color: #ef4444;">üí•</div>
                <div class="modal-title" style="color: #ef4444;">Oops! Try Again</div>
                <div class="modal-message" id="failure-message">
                    That combination didn't work as expected. Don't worry - every great alchemist learns from their mistakes!
                </div>
                <button class="modal-button" onclick="closeModal('failure-modal')">Try Again</button>
            </div>
        </div>
    </div>

    <script>
        // Game State
        const gameState = {
            currentFloor: 1,
            playerLevel: 1,
            essence: 25,
            crystals: 8,
            achievements: 0,
            cauldronContents: [],
            completedFloors: [],
            unlockedFloors: [1, 2]
        };
        
        // Game Data
        const floors = [
            {
                number: 1,
                name: "Chamber of Rust",
                description: "Learn basic acid-base reactions to remove rust from ancient artifacts",
                challenges: [
                    {
                        title: "The Rusty Knight",
                        description: "A brave knight's armor has become rusty after many battles. Create an acid solution to remove the rust (Fe‚ÇÇO‚ÇÉ) and restore the armor's shine!",
                        equation: "Fe‚ÇÇO‚ÇÉ + 6HCl ‚Üí 2FeCl‚ÇÉ + 3H‚ÇÇO",
                        solution: ["Fe‚ÇÇO‚ÇÉ", "HCl", "HCl", "HCl", "HCl", "HCl", "HCl"],
                        hint: "You need iron oxide and plenty of hydrochloric acid. Remember to balance the equation!"
                    }
                ]
            },
            {
                number: 2,
                name: "Hall of Neutralization",
                description: "Master pH balance and neutralization reactions",
                challenges: [
                    {
                        title: "The Acidic Lake",
                        description: "A magical lake has become too acidic, killing the fish. Create a basic solution to neutralize the acid and save the ecosystem!",
                        equation: "HCl + NaOH ‚Üí NaCl + H‚ÇÇO",
                        solution: ["HCl", "NaOH"],
                        hint: "Mix an acid with a base to create salt and water. One-to-one ratio!"
                    }
                ]
            },
            {
                number: 3,
                name: "Crystalline Cavern",
                description: "Explore crystallization and precipitation reactions",
                challenges: [
                    {
                        title: "The Crystal Garden",
                        description: "Create beautiful crystals for the royal garden by mixing silver nitrate with sodium chloride!",
                        equation: "AgNO‚ÇÉ + NaCl ‚Üí AgCl + NaNO‚ÇÉ",
                        solution: ["AgNO‚ÇÉ", "NaCl"],
                        hint: "Silver and chloride make a beautiful white precipitate!"
                    }
                ]
            },
            {
                number: 4,
                name: "Furnace of Combustion",
                description: "Learn about combustion reactions and energy release",
                challenges: [
                    {
                        title: "The Dragon's Breath",
                        description: "Help a young dragon perfect its fire breath by creating the perfect combustion reaction!",
                        equation: "CH‚ÇÑ + 2O‚ÇÇ ‚Üí CO‚ÇÇ + 2H‚ÇÇO",
                        solution: ["CH‚ÇÑ", "O‚ÇÇ", "O‚ÇÇ"],
                        hint: "Methane needs oxygen to burn completely. Don't forget the ratio!"
                    }
                ]
            },
            {
                number: 5,
                name: "Synthesis Sanctum",
                description: "Master complex synthesis reactions",
                challenges: [
                    {
                        title: "The Philosopher's Stone",
                        description: "Create the legendary compound that can transmute base metals into gold!",
                        equation: "2H‚ÇÇ + O‚ÇÇ ‚Üí 2H‚ÇÇO",
                        solution: ["H‚ÇÇ", "H‚ÇÇ", "O‚ÇÇ"],
                        hint: "The simplest synthesis - two gases become the essence of life!"
                    }
                ]
            }
        ];
        
        const ingredients = [
            { id: "Fe‚ÇÇO‚ÇÉ", name: "Iron Oxide", icon: "üî¥", color: "#dc2626" },
            { id: "HCl", name: "Hydrochloric Acid", icon: "üß™", color: "#16a34a" },
            { id: "NaOH", name: "Sodium Hydroxide", icon: "‚ö™", color: "#2563eb" },
            { id: "NaCl", name: "Sodium Chloride", icon: "üßÇ", color: "#f8fafc" },
            { id: "AgNO‚ÇÉ", name: "Silver Nitrate", icon: "‚ú®", color: "#6b7280" },
            { id: "CH‚ÇÑ", name: "Methane", icon: "üí®", color: "#fbbf24" },
            { id: "O‚ÇÇ", name: "Oxygen", icon: "üíô", color: "#3b82f6" },
            { id: "H‚ÇÇ", name: "Hydrogen", icon: "‚ö°", color: "#a855f7" },
            { id: "H‚ÇÇO", name: "Water", icon: "üíß", color: "#06b6d4" },
            { id: "CO‚ÇÇ", name: "Carbon Dioxide", icon: "‚òÅÔ∏è", color: "#64748b" }
        ];
        
        let currentChallenge = floors[0].challenges[0];
        
        // Initialize Game
        function initGame() {
            createParticles();
            renderFloors();
            renderIngredients();
            updateHUD();
            updateChallenge();
            startAIGuide();
        }
        
        // Create animated background particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (3 + Math.random() * 6) + 's';
                particlesContainer.appendChild(particle);
            }
        }
        
        // Render tower floors
        function renderFloors() {
            const container = document.getElementById('floors-container');
            container.innerHTML = '';
            
            floors.forEach(floor => {
                const floorElement = document.createElement('div');
                floorElement.className = 'floor';
                
                if (gameState.completedFloors.includes(floor.number)) {
                    floorElement.classList.add('completed');
                } else if (floor.number === gameState.currentFloor) {
                    floorElement.classList.add('active');
                } else if (!gameState.unlockedFloors.includes(floor.number)) {
                    floorElement.classList.add('locked');
                }
                
                const progress = gameState.completedFloors.includes(floor.number) ? 100 : 
                               floor.number === gameState.currentFloor ? 50 : 0;
                
                floorElement.innerHTML = `
                    <div class="floor-number">Floor ${floor.number}</div>
                    <div class="floor-name">${floor.name}</div>
                    <div class="floor-description">${floor.description}</div>
                    <div class="floor-progress">
                        <div class="floor-progress-bar" style="width: ${progress}%"></div>
                    </div>
                `;
                
                if (gameState.unlockedFloors.includes(floor.number)) {
                    floorElement.addEventListener('click', () => selectFloor(floor.number));
                }
                
                container.appendChild(floorElement);
            });
        }
        
        // Render ingredients grid
        function renderIngredients() {
            const container = document.getElementById('ingredients-grid');
            container.innerHTML = '';
            
            ingredients.forEach(ingredient => {
                const ingredientElement = document.createElement('div');
                ingredientElement.className = 'ingredient';
                ingredientElement.draggable = true;
                ingredientElement.innerHTML = `
                    <span class="ingredient-icon">${ingredient.icon}</span>
                    <div class="ingredient-name">${ingredient.name}<br><small style="opacity: 0.8; font-size: 14px;">${ingredient.id}</small></div>
                `;
                
                ingredientElement.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', ingredient.id);
                });
                
                ingredientElement.addEventListener('click', () => {
                    addToCauldron(ingredient.id);
                    createClickEffect(ingredientElement);
                });
                
                container.appendChild(ingredientElement);
            });
        }
        
        // Add ingredient to cauldron
        function addToCauldron(ingredientId) {
            if (gameState.cauldronContents.length < 10) {
                gameState.cauldronContents.push(ingredientId);
                updateCauldronDisplay();
                updateCurrentFormula();
                provideAIHint();
                
                // Visual feedback
                const cauldron = document.getElementById('cauldron-liquid');
                cauldron.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    cauldron.style.transform = 'scale(1)';
                }, 300);
            }
        }
        
        // Update cauldron visual
        function updateCauldronDisplay() {
            const liquid = document.getElementById('cauldron-liquid');
            const contents = gameState.cauldronContents;
            
            if (contents.length === 0) {
                liquid.style.background = 'linear-gradient(45deg, #667eea 0%, #764ba2 100%)';
                liquid.style.opacity = '0.3';
            } else {
                const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3', '#54a0ff'];
                const color1 = colors[contents.length % colors.length];
                const color2 = colors[(contents.length + 3) % colors.length];
                liquid.style.background = `linear-gradient(45deg, ${color1} 0%, ${color2} 100%)`;
                liquid.style.opacity = Math.min(0.9, 0.3 + contents.length * 0.1);
            }
        }
        
        // Update current formula display
        function updateCurrentFormula() {
            const display = document.getElementById('current-formula');
            if (gameState.cauldronContents.length > 0) {
                const formula = gameState.cauldronContents.join(' + ');
                display.textContent = `Current: ${formula}`;
            } else {
                display.textContent = 'Cauldron is empty';
            }
        }
        
        // Update HUD
        function updateHUD() {
            document.getElementById('player-level').textContent = gameState.playerLevel;
            document.getElementById('current-floor').textContent = gameState.currentFloor;
            document.getElementById('essence-count').textContent = gameState.essence;
            document.getElementById('crystal-count').textContent = gameState.crystals;
            document.getElementById('achievements-count').textContent = gameState.achievements;
        }
        
        // Update challenge display
        function updateChallenge() {
            const floor = floors.find(f => f.number === gameState.currentFloor);
            currentChallenge = floor.challenges[0];
            
            document.getElementById('challenge-title').textContent = currentChallenge.title;
            document.getElementById('challenge-description').textContent = currentChallenge.description;
            document.getElementById('challenge-equation').textContent = currentChallenge.equation;
        }
        
        // Select floor
        function selectFloor(floorNumber) {
            if (gameState.unlockedFloors.includes(floorNumber)) {
                gameState.currentFloor = floorNumber;
                gameState.cauldronContents = [];
                updateChallenge();
                updateCauldronDisplay();
                updateCurrentFormula();
                renderFloors();
                updateHUD();
                
                // Update AI guide message
                const guide = document.getElementById('guide-message');
                guide.textContent = `Welcome to Floor ${floorNumber}! ${currentChallenge.hint}`;
            }
        }
        
        // Brew potion (check solution)
        function brewPotion() {
            const userSolution = [...gameState.cauldronContents].sort();
            const correctSolution = [...currentChallenge.solution].sort();
            
            const isCorrect = userSolution.length === correctSolution.length && 
                            userSolution.every((val, index) => val === correctSolution[index]);
            
            if (isCorrect) {
                handleSuccess();
            } else {
                handleFailure();
            }
        }
        
        // Handle successful solution
        function handleSuccess() {
            gameState.essence += 10;
            gameState.crystals += 2;
            
            if (!gameState.completedFloors.includes(gameState.currentFloor)) {
                gameState.completedFloors.push(gameState.currentFloor);
                gameState.achievements++;
                
                // Unlock next floor
                if (gameState.currentFloor < floors.length && 
                    !gameState.unlockedFloors.includes(gameState.currentFloor + 1)) {
                    gameState.unlockedFloors.push(gameState.currentFloor + 1);
                }
                
                // Level up every 2 floors
                if (gameState.completedFloors.length % 2 === 0) {
                    gameState.playerLevel++;
                }
            }
            
            updateHUD();
            renderFloors();
            showModal('success-modal');
            
            // Create success particles
            createSuccessEffect();
            
            // Reset cauldron
            gameState.cauldronContents = [];
            updateCauldronDisplay();
            updateCurrentFormula();
        }
        
        // Handle failed solution
        function handleFailure() {
            showModal('failure-modal');
            
            // Shake cauldron
            const cauldron = document.getElementById('cauldron');
            cauldron.style.animation = 'shake 0.5s ease-in-out';
            setTimeout(() => {
                cauldron.style.animation = '';
            }, 500);
            
            // Provide more specific hint
            provideDetailedHint();
        }
        
        // Show modal
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'flex';
        }
        
        // Close modal
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'none';
        }
        
        // Create success particle effect
        function createSuccessEffect() {
            const cauldron = document.getElementById('cauldron');
            const rect = cauldron.getBoundingClientRect();
            
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.style.position = 'fixed';
                particle.style.left = rect.left + rect.width/2 + 'px';
                particle.style.top = rect.top + rect.height/2 + 'px';
                particle.style.width = '6px';
                particle.style.height = '6px';
                particle.style.background = '#ffd700';
                particle.style.borderRadius = '50%';
                particle.style.pointerEvents = 'none';
                particle.style.zIndex = '9999';
                
                const angle = (i / 20) * Math.PI * 2;
                const velocity = 100 + Math.random() * 100;
                const vx = Math.cos(angle) * velocity;
                const vy = Math.sin(angle) * velocity;
                
                document.body.appendChild(particle);
                
                let x = 0, y = 0, opacity = 1;
                const animate = () => {
                    x += vx * 0.016;
                    y += vy * 0.016;
                    opacity -= 0.016;
                    
                    particle.style.transform = `translate(${x}px, ${y}px)`;
                    particle.style.opacity = opacity;
                    
                    if (opacity > 0) {
                        requestAnimationFrame(animate);
                    } else {
                        document.body.removeChild(particle);
                    }
                };
                
                requestAnimationFrame(animate);
            }
        }
        
        // Create click effect
        function createClickEffect(element) {
            const effect = document.createElement('div');
            effect.style.position = 'absolute';
            effect.style.top = '50%';
            effect.style.left = '50%';
            effect.style.width = '20px';
            effect.style.height = '20px';
            effect.style.background = '#ffd700';
            effect.style.borderRadius = '50%';
            effect.style.transform = 'translate(-50%, -50%)';
            effect.style.animation = 'clickEffect 0.6s ease-out forwards';
            effect.style.pointerEvents = 'none';
            
            element.style.position = 'relative';
            element.appendChild(effect);
            
            setTimeout(() => {
                if (effect.parentNode) {
                    effect.parentNode.removeChild(effect);
                }
            }, 600);
        }
        
        // Enhanced AI Guide system with agentic behavior
        class AgenticAIGuide {
            constructor() {
                this.knowledge = {
                    reactions: {
                        'Fe‚ÇÇO‚ÇÉ + HCl': {
                            type: 'acid-base',
                            explanation: 'Iron oxide (rust) reacts with hydrochloric acid to form iron chloride and water',
                            realWorld: 'This is how rust removers work on metal surfaces',
                            balancing: 'You need 6 HCl molecules for every 1 Fe‚ÇÇO‚ÇÉ molecule'
                        },
                        'HCl + NaOH': {
                            type: 'neutralization',
                            explanation: 'Strong acid meets strong base to form salt and water',
                            realWorld: 'This neutralizes acidic spills or basic solutions',
                            balancing: 'Perfect 1:1 ratio - one acid molecule neutralizes one base molecule'
                        }
                    },
                    misconceptions: [
                        { pattern: 'too_much_acid', message: 'Too much acid can be dangerous! Chemistry is about perfect balance.' },
                        { pattern: 'missing_catalyst', message: 'Some reactions need a catalyst to speed up. Think about what helps reactions happen faster.' },
                        { pattern: 'wrong_order', message: 'Order of addition matters in chemistry! Some reactions are sensitive to sequence.' }
                    ]
                };
                this.conversationHistory = [];
                this.studentProfile = {
                    strengths: [],
                    weaknesses: [],
                    learningStyle: 'visual', // visual, analytical, hands-on
                    mistakePatterns: []
                };
            }

            analyzeStudentAttempt(userContents, correctSolution, attemptNumber) {
                const analysis = {
                    correctIngredients: [],
                    missingIngredients: [],
                    extraIngredients: [],
                    ratioErrors: [],
                    conceptualErrors: []
                };

                // Analyze ingredient presence
                const correctCount = {};
                const userCount = {};
                
                correctSolution.forEach(ing => correctCount[ing] = (correctCount[ing] || 0) + 1);
                userContents.forEach(ing => userCount[ing] = (userCount[ing] || 0) + 1);

                // Check ratios and missing/extra ingredients
                Object.keys(correctCount).forEach(ingredient => {
                    const needed = correctCount[ingredient];
                    const provided = userCount[ingredient] || 0;
                    
                    if (provided === 0) {
                        analysis.missingIngredients.push({ ingredient, needed });
                    } else if (provided !== needed) {
                        analysis.ratioErrors.push({ ingredient, needed, provided });
                    } else {
                        analysis.correctIngredients.push(ingredient);
                    }
                });

                Object.keys(userCount).forEach(ingredient => {
                    if (!correctCount[ingredient]) {
                        analysis.extraIngredients.push(ingredient);
                    }
                });

                return analysis;
            }

            generatePersonalizedHint(analysis, challenge, attemptNumber) {
                let hint = "";
                const studentStyle = this.studentProfile.learningStyle;

                if (attemptNumber === 1) {
                    // First attempt - gentle guidance
                    if (analysis.missingIngredients.length > 0) {
                        hint = `I notice you're missing some key ingredients. Think about what the equation tells us: ${challenge.equation}. `;
                        if (studentStyle === 'visual') {
                            hint += "Try visualizing each side of the equation - what molecules do you see?";
                        } else if (studentStyle === 'analytical') {
                            hint += "Count the atoms on each side - they must balance!";
                        }
                    }
                } else if (attemptNumber === 2) {
                    // Second attempt - more specific
                    if (analysis.ratioErrors.length > 0) {
                        const error = analysis.ratioErrors[0];
                        hint = `You have ${error.provided} ${error.ingredient}, but you need ${error.needed}. `;
                        hint += "In chemistry, the numbers in front of molecules (coefficients) tell us the exact ratios needed!";
                    }
                } else {
                    // Third+ attempt - very specific help
                    hint = "Let me break this down step by step:\n";
                    if (analysis.missingIngredients.length > 0) {
                        hint += `Missing: ${analysis.missingIngredients.map(m => `${m.needed} ${m.ingredient}`).join(', ')}\n`;
                    }
                    if (analysis.extraIngredients.length > 0) {
                        hint += `Remove: ${analysis.extraIngredients.join(', ')}\n`;
                    }
                    hint += "The equation shows you exactly what you need!";
                }

                this.conversationHistory.push({ type: 'hint', content: hint, attempt: attemptNumber });
                return hint;
            }

            adaptToStudent(success, timeSpent, mistakeType) {
                // Learn from student behavior
                if (success && timeSpent < 30) {
                    this.studentProfile.strengths.push('quick_learner');
                } else if (!success && mistakeType === 'ratio') {
                    this.studentProfile.weaknesses.push('stoichiometry');
                    this.studentProfile.learningStyle = 'analytical'; // Needs more structured approach
                }
            }

            provideEncouragement(consecutiveFailures) {
                const encouragements = [
                    "Every great chemist started as a beginner! You're learning with each attempt.",
                    "Mistakes are how we discover new things in science. Keep experimenting!",
                    "Even Nobel Prize winners had to practice their chemistry. You're on the right path!",
                    "Chemistry is like solving puzzles - each piece teaches you something new.",
                    "Remember, understanding WHY something works is more important than getting it right immediately."
                ];
                
                return encouragements[Math.min(consecutiveFailures, encouragements.length - 1)];
            }

            explainReaction(challenge) {
                const reactionKey = Object.keys(this.knowledge.reactions).find(key => 
                    challenge.equation.includes(key.split(' + ')[0]) && challenge.equation.includes(key.split(' + ')[1])
                );
                
                if (reactionKey) {
                    const reaction = this.knowledge.reactions[reactionKey];
                    return `üî¨ Reaction Explanation: ${reaction.explanation}\nüí° Real World: ${reaction.realWorld}\n‚öñÔ∏è Balancing Tip: ${reaction.balancing}`;
                }
                
                return "This is a fascinating chemical reaction! Each ingredient plays a specific role in creating the final product.";
            }
        }

        // Initialize the agentic AI
        const aiGuide = new AgenticAIGuide();
        let attemptCounter = 0;
        let consecutiveFailures = 0;

        function provideAIHint() {
            const guide = document.getElementById('guide-message');
            const contents = gameState.cauldronContents;
            const solution = currentChallenge.solution;
            
            if (contents.length === 0) {
                guide.textContent = currentChallenge.hint;
            } else if (contents.length < solution.length) {
                const missing = solution.filter(item => 
                    contents.filter(c => c === item).length < solution.filter(s => s === item).length
                );
                if (missing.length > 0) {
                    guide.textContent = `Good start! You still need: ${missing.join(', ')}`;
                }
            } else if (contents.length === solution.length) {
                guide.textContent = "Perfect amount! Try brewing your potion now.";
            } else {
            guide.textContent = "That might be too much. Consider removing some ingredients.";
        }
        }
        
        // Provide detailed hint after failure
        function provideDetailedHint() {
            const guide = document.getElementById('guide-message');
            const contents = gameState.cauldronContents;
            const solution = currentChallenge.solution;
            
            let hint = "Let me help you: ";
            
            if (contents.length === 0) {
                hint += "You need to add some ingredients first!";
            } else if (contents.length !== solution.length) {
                hint += `You need exactly ${solution.length} ingredients, but you have ${contents.length}.`;
            } else {
                const missing = solution.filter(item => !contents.includes(item));
                const extra = contents.filter(item => !solution.includes(item));
                
                if (missing.length > 0) {
                    hint += `Missing: ${missing.join(', ')}. `;
                }
                if (extra.length > 0) {
                    hint += `Extra: ${extra.join(', ')}.`;
                }
            }
            
            guide.textContent = hint;
        }
        
        // Start AI guide with welcome message
        function startAIGuide() {
            setTimeout(() => {
                const guide = document.getElementById('guide-message');
                guide.textContent = "Welcome to the Tower of Elements! I'm Athena, your wise guide. Drag ingredients into the cauldron or click them to add. Let's start with the rusty knight's problem!";
            }, 1000);
        }
        
        // Add drag and drop support for cauldron
        function setupDragAndDrop() {
            const cauldron = document.getElementById('cauldron');
            
            cauldron.addEventListener('dragover', (e) => {
                e.preventDefault();
                cauldron.style.transform = 'scale(1.1)';
                cauldron.style.boxShadow = '0 15px 40px rgba(255, 215, 0, 0.5)';
            });
            
            cauldron.addEventListener('dragleave', () => {
                cauldron.style.transform = 'scale(1)';
                cauldron.style.boxShadow = '0 10px 30px rgba(0, 0, 0, 0.5)';
            });
            
            cauldron.addEventListener('drop', (e) => {
                e.preventDefault();
                const ingredientId = e.dataTransfer.getData('text/plain');
                addToCauldron(ingredientId);
                cauldron.style.transform = 'scale(1)';
                cauldron.style.boxShadow = '0 10px 30px rgba(0, 0, 0, 0.5)';
            });
        }
        
        // Clear cauldron function
        function clearCauldron() {
            gameState.cauldronContents = [];
            updateCauldronDisplay();
            updateCurrentFormula();
            
            const guide = document.getElementById('guide-message');
            guide.textContent = "Cauldron cleared! Ready for a fresh start.";
        }
        
        // Add keyboard shortcuts
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'Enter':
                        brewPotion();
                        break;
                    case 'Escape':
                        clearCauldron();
                        break;
                    case 'c':
                        if (e.ctrlKey) {
                            clearCauldron();
                        }
                        break;
                }
            });
        }
        
        // Add CSS for shake animation
        const shakeKeyframes = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }
            
            @keyframes clickEffect {
                0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
                100% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
            }
        `;
        
        const styleSheet = document.createElement('style');
        styleSheet.textContent = shakeKeyframes;
        document.head.appendChild(styleSheet);
        
        // Event Listeners
        document.getElementById('brew-button').addEventListener('click', brewPotion);
        document.getElementById('cauldron').addEventListener('dblclick', clearCauldron);
        
        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', () => {
            initGame();
            setupDragAndDrop();
            setupKeyboardShortcuts();
        });
        
        // Add window resize handler for responsiveness
        window.addEventListener('resize', () => {
            // Adjust particles on resize
            const particles = document.querySelectorAll('.particle');
            particles.forEach(particle => {
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
            });
        });
    </script>
</body>
</html>